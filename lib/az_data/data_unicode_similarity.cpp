#include "az/core/config.h"

#include <spdlog/spdlog.h>

#include <unordered_map>
#include <unordered_set>
#include <string>

namespace az::data::impl::unicode {
    // see groupSimilarChars in www/playground/mathjax-fork-jit/index.ts
    std::unordered_map<UCharType, std::unordered_set<UCharType>> SIMILAR_CHAR_RECORD = {
            {"\"", {"\"", "â€œ", "â€",}},
            {"'",  {"'",  "â€˜", "â€™",}},
            {"(",  {"(",  "âŸ®",}},
            {")",  {")",  "âŸ¯",}},
            {"*",  {"*",  "â‹†",}},
            {"+",  {"+",  "â€ ", "âˆ”",}},
            {",",  {",",  "Â´", "ËŠ", "â€²",}},
            {"-",  {"-",  "_", "Â¯", "Ë‰", "â€“", "â€”", "â€•", "â€¾", "âˆ’", "ï¿£",}},
            {".",  {".",  "Â·", "Ë™", "â€¢", "âˆ™", "â‹…",}},
            {"/",  {"/",  "â„", "âˆ•", "â§¸",}},
            {"1",  {"1",  "l", "â… ", "âˆ£", "âœ", "âŸ", "â¢", "â¥", "âª", "â",}},
            {"2",  {"2",  "Z", "z", "Î–", "â„¤",}},
            {"6",  {"6",  "b", "â™­",}},
            {"7",  {"7",  "î€—",}},
            {"9",  {"9",}},
            {"<",  {"<",  "â‰º", "ã€ˆ", "âŸ¨", "ã€ˆ",}},
            {"=",  {"=",  "â€—",}},
            {">",  {">",  "â‰»", "ã€‰", "âŸ©", "ã€‰",}},
            {"A",  {"A",  "Î‘",}},
            {"B",  {"B",  "Î’",}},
            {"C",  {"C",  "c", "âˆ",}},
            {"E",  {"E",  "Î•",}},
            {"H",  {"H",  "Î—", "â„",}},
            {"I",  {"I",  "Î™",}},
            {"J",  {"J",  "È·",}},
            {"K",  {"K",  "k", "Îš", "Îº", "î…’",}},
            {"M",  {"M",  "Îœ",}},
            {"N",  {"N",  "Î", "â„•",}},
            {"O",  {"O",  "o", "ÎŸ", "Î¿", "â—¯", "î€",}},
            {"P",  {"P",  "p", "Î¡", "Ï", "â„™",}},
            {"Q",  {"Q",  "â„š",}},
            {"R",  {"R",  "â„",}},
            {"S",  {"S",  "s",}},
            {"T",  {"T",  "Î¤", "âŠ¤", "âŠº",}},
            {"U",  {"U",  "u", "âˆ", "âˆª", "â‹ƒ", "îŒ‡",}},
            {"V",  {"V",  "v", "Î½", "â…¤", "â…´", "âˆ¨", "â‹",}},
            {"W",  {"W",  "w", "Ï‰", "ğœ›", "ğ•",}},
            {"X",  {"X",  "x", "Ã—", "Î§", "Ï°", "â…©", "â…¹", "â¨¯", "ğ’",}},
            {"Y",  {"Y",  "Î¥", "Î³", "â‹",}},
            {"\\", {"\\", "âˆ–",}},
            {"^",  {"^",  "Ë†", "Î›", "â‹€", "â‹",}},
            {"`",  {"`",  "Ë‹", "â€µ",}},
            {"d",  {"d",  "â…†",}},
            {"e",  {"e",  "â…‡",}},
            {"h",  {"h",  "â„",}},
            {"i",  {"i",  "â…ˆ", "â…°",}},
            {"n",  {"n",  "âˆ", "âˆ©", "â‹‚",}},
            {"q",  {"q",}},
            {"y",  {"y",  "ğ‘¦",}},
            {"~",  {"~",  "Ëœ", "âˆ¼",}},
            {"Ë‡",  {"Ë‡",  "Ë˜",}},
            {"Î”",  {"Î”",  "âˆ†", "â–³", "â–µ",}},
            {"Î£",  {"Î£",  "âˆ‘", "î…‘",}},
            {"Î¦",  {"Î¦",  "Ï•", "ğœ™",}},
            {"Î±",  {"Î±",  "âˆ",}},
            {"Ïµ",  {"Ïµ",  "âˆˆ", "ğ",}},
            {"â€–",  {"â€–",  "â…¡",}},
            {"â€¦",  {"â€¦",  "â‹¯",}},
            {"â†’",  {"â†’",  "âŸ¶", "î€†",}},
            {"âˆ‚",  {"âˆ‚",  "ğœ•", "ğ",}},
            {"âˆ‡",  {"âˆ‡",  "â–½", "â–¿", "ğ›",}},
            {"âˆ‹",  {"âˆ‹",  "âˆ",}},
            {"âŠ•",  {"âŠ•",  "â¨",}},
            {"âŠ–",  {"âŠ–",  "âŠ",}},
            {"âŠ—",  {"âŠ—",  "â¨‚",}},
            {"âŠ™",  {"âŠ™",  "â¨€",}},

    };

    std::unordered_map<UCharType, UCharType> SIMILAR_CHAR_MAP = []() {
        std::unordered_map<UCharType, UCharType> result;
        for (const auto &[key, set]: SIMILAR_CHAR_RECORD) {
            for (const auto &item: set) {
                auto success = result.insert({item, key}).second;
                if (!success) {
                    SPDLOG_ERROR("failed to insert <{},{}>, <{},{}> already exist",
                                 item, key, item, result[item]);
                }
            }
        }
        return result;
    }();
}
